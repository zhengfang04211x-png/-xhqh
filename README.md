# OmniHedge 系统

全自动化金融数据分析和套保必要性评估系统

## 项目结构

```
CU/
├── 数据网关.py          # 第一步：数据网关（数据处理核心）
├── 套保分析器.py         # 第二步：套保分析器（分析核心）
├── 数据预处理.py         # 数据预处理脚本（一次性运行）
├── 运行程序.py           # 主运行程序（基于预处理数据）
└── processed_data.pkl   # 预处理后的数据文件（自动生成）
```

## 快速开始

### 1. 安装依赖

```bash
pip install pandas numpy scipy
```

### 2. 预处理数据（首次运行或数据更新后）

```bash
python 数据预处理.py
```

这会扫描所有CSV文件，处理并保存为 `processed_data.pkl`。

### 3. 运行分析

```bash
python 运行程序.py
```

修改 `运行程序.py` 中的参数配置区域来测试不同的参数。

## 使用流程

### 首次使用

1. **预处理数据**（只需要运行一次）
   ```bash
   python 数据预处理.py
   ```

2. **修改参数**（在 `运行程序.py` 文件开头）
   ```python
   HEDGE_DAYS = 30              # 持仓天数
   TARGET_CONFIDENCE = 0.95     # 置信水平
   POSITION_VALUE = 1000000.0   # 持仓价值
   COST_CONFIG = {...}          # 成本配置
   ```

3. **运行分析**
   ```bash
   python 运行程序.py
   ```

### 后续使用

如果数据没有更新，只需要：
```bash
python 运行程序.py
```

直接基于预处理好的数据进行分析，无需重新扫描CSV文件。

## 参数说明

在 `运行程序.py` 中可以修改以下参数：

### 企业持仓参数

- `HEDGE_DAYS`: 计划持仓天数（如：7, 15, 30, 60, 90）
- `TARGET_CONFIDENCE`: 置信水平（如：0.90, 0.95, 0.99）
- `POSITION_VALUE`: 持仓价值，单位：元

### 成本配置

- `commission_rate`: 手续费率（0.0002 = 万分之二）
- `financing_rate`: 融资利率，年化（0.05 = 5%）
- `slippage_rate`: 滑点率（0.0001 = 万分之一）
- `margin_rate`: 保证金比例（0.1 = 10%）

## 输出文件

- `processed_data.pkl`: 预处理后的数据（二进制格式）
- `processed_data_panel.csv`: 统一数据面板（CSV格式，便于查看）
- `hedge_analysis_summary.csv`: 分析结果摘要

## 代码说明

### 数据网关.py

数据网关类，负责：
- 自动扫描和识别CSV文件
- 识别期货和现货数据
- 字段归一化
- 数据清洗和对齐
- 生成统一数据面板

### 套保分析器.py

套保分析器类，负责：
- 波动风险评估（VaR计算）
- 全项成本核算
- 基差风险分析
- 套保性价比判定
- 输出决策建议

### 数据预处理.py

数据预处理脚本：
- 一次性处理所有CSV文件
- 生成统一格式的数据
- 保存为 `.pkl` 格式供后续使用

### 运行程序.py

主运行程序：
- 从预处理数据加载
- 配置分析参数
- 执行分析
- 输出报告

## 注意事项

1. **首次使用必须先运行 `数据预处理.py`**
2. 如果CSV文件有更新，需要重新运行预处理脚本
3. 所有代码使用UTF-8编码，支持中文路径和列名
4. Windows系统会自动设置控制台编码为UTF-8
5. **文件名使用中文**，Python支持中文文件名，但建议在支持UTF-8的环境中运行

## 依赖库

- pandas
- numpy
- scipy

## License

MIT License
